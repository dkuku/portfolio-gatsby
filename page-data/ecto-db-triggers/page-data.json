{"componentChunkName":"component---src-templates-blog-post-js","path":"/ecto-db-triggers","result":{"data":{"markdownRemark":{"html":"<h1>To easy use postgres triggers woth ecto I created 2 files:</h1>\n<ul>\n<li>First to create the function I want to trigger</li>\n<li>Second to create the trigger</li>\n</ul>\n<pre><code class=\"language-SQL\">defmodule Workpermit.Repo.Migrations.NextPermitNumberFunction do\n  use Ecto.Migration\n\n  def up do\n    execute \"\"\"\n    CREATE OR REPLACE FUNCTION next_permit()\n    RETURNS TRIGGER AS $category_number$ \n      BEGIN \n        SELECT coalesce(max(number), 0)+1 INTO NEW.number \n          FROM permits WHERE category = NEW.category;   \n        RETURN NEW; \n      END; \n    $category_number$ LANGUAGE plpgsql;\n    \"\"\"\n  end\n\n  def down do\n    execute \"DROP FUNCTION IF EXISTS next_permit() CASCADE;\"\n  end\nend\n</code></pre>\n<pre><code class=\"language-SQL\">defmodule Workpermit.Repo.Migrations.TriggerNextPermitNumber do\n  use Ecto.Migration\n\n  def up do\n    execute \"CREATE TRIGGER update_next_permit_number \n    BEFORE INSERT ON PERMITS\n    FOR EACH ROW EXECUTE PROCEDURE next_permit();\"\n  end\n\n  def down do\n    execute \"DROP TRIGGER IF EXISTS update_next_permit_number ON permits;\"\n  end\nend\n</code></pre>","frontmatter":{"title":"Ecto-and-database-trigers","date":"January, 30, 2020","path":"/ecto-db-triggers","tags":["ecto","postpres"],"excerpt":""}}},"pageContext":{"prev":null,"next":{"html":"<p>The blog was set up using this <a href=\"https://blog.bitsrc.io/build-your-own-blog-using-gatsby-and-react-a1255a5ab086\">post.</a>\nNow I can start to write posts</p>","id":"870e4ad8-7757-5865-9e27-b8f40e85555b","frontmatter":{"date":"2018-03-30T12:34:00+00:00","path":"/blog-setup","title":"Blog setup","excerpt":"This is the first post","tags":["gatsby","react","portfolio"]}}}}}