{"expireTime":9007200834798297000,"key":"transformer-remark-markdown-ast-317d923357b7e598932c00756bb3b603--","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"In this blogpost I want to show how to make phoenix use svelte in templates.\nSo lets start:","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":2,"column":15,"offset":91},"indent":[1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":2,"column":15,"offset":91},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Edit your ","position":{"start":{"line":4,"column":1,"offset":93},"end":{"line":4,"column":11,"offset":103},"indent":[]}},{"type":"inlineCode","value":"asset/package.json","position":{"start":{"line":4,"column":11,"offset":103},"end":{"line":4,"column":31,"offset":123},"indent":[]}},{"type":"text","value":" file and add these 3 lines to devDependencies - also remove uglifyjs - we will replace it with terser which is a maintained fork of uglify","position":{"start":{"line":4,"column":31,"offset":123},"end":{"line":4,"column":170,"offset":262},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":93},"end":{"line":4,"column":170,"offset":262},"indent":[]}},{"type":"code","lang":"diff","meta":null,"value":"+    \"svelte\": \"^3.12.1\",\n+    \"svelte-loader\": \"^2.13.6\",\n+    \"terser-webpack-plugin\": \"^2.1.1\",\n-    \"uglifyjs-webpack-plugin\": \"^1.2.4\",","position":{"start":{"line":5,"column":1,"offset":263},"end":{"line":10,"column":4,"offset":415},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next run ","position":{"start":{"line":11,"column":1,"offset":416},"end":{"line":11,"column":10,"offset":425},"indent":[]}},{"type":"inlineCode","value":"npm install","position":{"start":{"line":11,"column":10,"offset":425},"end":{"line":11,"column":23,"offset":438},"indent":[]}},{"type":"text","value":"\nafter everything is installed we can move to the webpack setup:\nremove uglify, import terser and add the initialization:","position":{"start":{"line":11,"column":23,"offset":438},"end":{"line":13,"column":57,"offset":559},"indent":[1,1]}}],"position":{"start":{"line":11,"column":1,"offset":416},"end":{"line":13,"column":57,"offset":559},"indent":[1,1]}},{"type":"code","lang":"bash","meta":null,"value":"const UglifyJsPlugin = require('uglifyjs-webpack-plugin');","position":{"start":{"line":14,"column":1,"offset":560},"end":{"line":16,"column":4,"offset":630},"indent":[1,1]}},{"type":"code","lang":"javascript","meta":null,"value":"const TerserPlugin = require('terser-webpack-plugin');\n\nmodule.exports = (env, options) => ({\n  optimization: {\n    minimizer: [\n      new UglifyJsPlugin({ cache: true, parallel: true, sourceMap: false }),\n      new TerserPlugin(),\n      new OptimizeCSSAssetsPlugin({})\n    ]\n  },","position":{"start":{"line":17,"column":1,"offset":631},"end":{"line":28,"column":4,"offset":929},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next add a resolve section:","position":{"start":{"line":29,"column":1,"offset":930},"end":{"line":29,"column":28,"offset":957},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":930},"end":{"line":29,"column":28,"offset":957},"indent":[]}},{"type":"code","lang":"javascript","meta":null,"value":"  entry: {\n    './js/app.js': ['./js/app.js']\n  },\n  resolve: {\n    alias: {\n      svelte: path.resolve('node_modules', 'svelte')\n    },\n    extensions: ['.mjs', '.js', '.svelte'],\n    mainFields: ['svelte', 'browser', 'module', 'main'],\n    modules: ['node_modules']\n  },","position":{"start":{"line":30,"column":1,"offset":958},"end":{"line":42,"column":4,"offset":1248},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Add also these two  - the mjs part is needed because otherwise webpack throws an error that no require function can be used in the browser","position":{"start":{"line":43,"column":1,"offset":1249},"end":{"line":43,"column":139,"offset":1387},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":1249},"end":{"line":43,"column":139,"offset":1387},"indent":[]}},{"type":"code","lang":"javascript","meta":null,"value":"        use: {\n          loader: 'babel-loader'\n        },\n      },\n      {\n        test: /\\.mjs$/,\n        include: /node_modules/,\n        type: \"javascript/auto\",\n      },\n      {\n        test: /\\.(html|svelte)$/,\n        exclude: /node_modules/,\n        use: {\n          loader: 'svelte-loader',\n          options: {\n            hotReload: true\n          }\n         }\n       }\n     ]","position":{"start":{"line":44,"column":1,"offset":1388},"end":{"line":65,"column":4,"offset":1793},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"with this setup we can include svelte templates to our views\nIn  ","position":{"start":{"line":66,"column":1,"offset":1794},"end":{"line":67,"column":5,"offset":1859},"indent":[1]}},{"type":"inlineCode","value":"/assets/js/app.js","position":{"start":{"line":67,"column":5,"offset":1859},"end":{"line":67,"column":24,"offset":1878},"indent":[]}},{"type":"text","value":" add","position":{"start":{"line":67,"column":24,"offset":1878},"end":{"line":67,"column":28,"offset":1882},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":1794},"end":{"line":67,"column":28,"offset":1882},"indent":[1]}},{"type":"code","lang":null,"meta":null,"value":"import './svelte.js';","position":{"start":{"line":68,"column":1,"offset":1883},"end":{"line":70,"column":4,"offset":1912},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In ","position":{"start":{"line":71,"column":1,"offset":1913},"end":{"line":71,"column":4,"offset":1916},"indent":[]}},{"type":"inlineCode","value":"/assets/js/svelte.js","position":{"start":{"line":71,"column":4,"offset":1916},"end":{"line":71,"column":26,"offset":1938},"indent":[]}},{"type":"text","value":" with this content:","position":{"start":{"line":71,"column":26,"offset":1938},"end":{"line":71,"column":45,"offset":1957},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":1913},"end":{"line":71,"column":45,"offset":1957},"indent":[]}},{"type":"code","lang":"javascript","meta":null,"value":"import App from './App.svelte'\n\nconst app = new App({\n\ttarget: document.querySelector('.svelte'),\n\tprops: {\n\t\tname: 'svelte'\n\t}\n})\nexport default app","position":{"start":{"line":72,"column":1,"offset":1958},"end":{"line":82,"column":4,"offset":2125},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"And in  ","position":{"start":{"line":83,"column":1,"offset":2126},"end":{"line":83,"column":9,"offset":2134},"indent":[]}},{"type":"inlineCode","value":"/assets/js/App.svelte","position":{"start":{"line":83,"column":9,"offset":2134},"end":{"line":83,"column":32,"offset":2157},"indent":[]}},{"type":"text","value":" add:","position":{"start":{"line":83,"column":32,"offset":2157},"end":{"line":83,"column":37,"offset":2162},"indent":[]}}],"position":{"start":{"line":83,"column":1,"offset":2126},"end":{"line":83,"column":37,"offset":2162},"indent":[]}},{"type":"code","lang":"html","meta":null,"value":"<script>\n\texport let name;\n</script>\n<h1>Phoenix and {name}!</h1>","position":{"start":{"line":84,"column":1,"offset":2163},"end":{"line":89,"column":4,"offset":2240},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"last thing what we need to do is to add an element where this can be attached to our view:","position":{"start":{"line":90,"column":1,"offset":2241},"end":{"line":90,"column":91,"offset":2331},"indent":[]}}],"position":{"start":{"line":90,"column":1,"offset":2241},"end":{"line":90,"column":91,"offset":2331},"indent":[]}},{"type":"code","lang":"html","meta":null,"value":"<div class=\"svelte\"></div>","position":{"start":{"line":91,"column":1,"offset":2332},"end":{"line":93,"column":4,"offset":2370},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This should render a h1 tag with the content ","position":{"start":{"line":94,"column":1,"offset":2371},"end":{"line":94,"column":46,"offset":2416},"indent":[]}},{"type":"inlineCode","value":"Phoenix and svelte","position":{"start":{"line":94,"column":46,"offset":2416},"end":{"line":94,"column":66,"offset":2436},"indent":[]}},{"type":"text","value":"\nThats the basic setup but what if we want more??","position":{"start":{"line":94,"column":66,"offset":2436},"end":{"line":95,"column":49,"offset":2485},"indent":[1]}}],"position":{"start":{"line":94,"column":1,"offset":2371},"end":{"line":95,"column":49,"offset":2485},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Lets add a view helper in ","position":{"start":{"line":97,"column":1,"offset":2487},"end":{"line":97,"column":27,"offset":2513},"indent":[]}},{"type":"inlineCode","value":"lib/myapp_web/views/layout_view.ex","position":{"start":{"line":97,"column":27,"offset":2513},"end":{"line":97,"column":63,"offset":2549},"indent":[]}},{"type":"text","value":" add these functions:","position":{"start":{"line":97,"column":63,"offset":2549},"end":{"line":97,"column":84,"offset":2570},"indent":[]}}],"position":{"start":{"line":97,"column":1,"offset":2487},"end":{"line":97,"column":84,"offset":2570},"indent":[]}},{"type":"code","lang":"elixir","meta":null,"value":"  def svelte(name, props) do\n    :div\n    |> tag([data: [props: json(props)], id: generate_id(name)])\n  end\n\n  def json(props) do\n    props\n    |> Jason.encode\n    |> case do\n      {:ok, message} -> message\n      {:error, _} -> \"\"\n    end\n  end\n\n  def generate_id(name) do\n    \"svelte-#{String.replace(name, \" \", \"-\")}-root\"\n  end","position":{"start":{"line":98,"column":1,"offset":2571},"end":{"line":116,"column":4,"offset":2915},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"this allows us to use a helper in our templates:","position":{"start":{"line":117,"column":1,"offset":2916},"end":{"line":117,"column":49,"offset":2964},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":2916},"end":{"line":117,"column":49,"offset":2964},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"<%= svelte \"test\", %{:name => \"svelte\"} %>","position":{"start":{"line":118,"column":1,"offset":2965},"end":{"line":120,"column":4,"offset":3015},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"we can pass as many params in this map as we want\nthen we need to create a directory ","position":{"start":{"line":121,"column":1,"offset":3016},"end":{"line":122,"column":36,"offset":3101},"indent":[1]}},{"type":"inlineCode","value":"assets/js/svelte","position":{"start":{"line":122,"column":36,"offset":3101},"end":{"line":122,"column":54,"offset":3119},"indent":[]}},{"type":"text","value":"\nand inside create new files with the same name as the first param passed to the svelte helper:\n","position":{"start":{"line":122,"column":54,"offset":3119},"end":{"line":124,"column":1,"offset":3215},"indent":[1,1]}},{"type":"inlineCode","value":"assets/js/svelte/test.svelte","position":{"start":{"line":124,"column":1,"offset":3215},"end":{"line":124,"column":31,"offset":3245},"indent":[]}},{"type":"text","value":"\nwith normal svelte style templating:","position":{"start":{"line":124,"column":31,"offset":3245},"end":{"line":125,"column":37,"offset":3282},"indent":[1]}}],"position":{"start":{"line":121,"column":1,"offset":3016},"end":{"line":125,"column":37,"offset":3282},"indent":[1,1,1,1]}},{"type":"code","lang":"html","meta":null,"value":" <script>\n \texport let name;\n </script>\n \n<h1>Phoenix and {name}!</h1>","position":{"start":{"line":126,"column":1,"offset":3283},"end":{"line":132,"column":4,"offset":3365},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"the last part is to let out app know how to fin these templates:\nFor this to work lets replace the content of ","position":{"start":{"line":133,"column":1,"offset":3366},"end":{"line":134,"column":46,"offset":3476},"indent":[1]}},{"type":"inlineCode","value":"assets/js/svelte.js","position":{"start":{"line":134,"column":46,"offset":3476},"end":{"line":134,"column":67,"offset":3497},"indent":[]}},{"type":"text","value":" with:","position":{"start":{"line":134,"column":67,"offset":3497},"end":{"line":134,"column":73,"offset":3503},"indent":[]}}],"position":{"start":{"line":133,"column":1,"offset":3366},"end":{"line":134,"column":73,"offset":3503},"indent":[1]}},{"type":"code","lang":"javascript","meta":null,"value":"const context = require.context(\"./svelte\", false, /\\.svelte/);\nwindow.onload = function() {\n  context.keys().forEach((file) => {\n    const componentName = file.replace(/\\.\\/|\\.svelte/g, '');\n    const targetId = `svelte-${componentName}-root`;\n\n    const root = document.getElementById(targetId);\n\n    if(!root){\n      return;\n    }\n\n    const requiredApp = require(`./svelte/${componentName}.svelte`);\n\n    const props = root.getAttribute('data-props');\n    let parsedProps = {};\n    if(props){\n      parsedProps = JSON.parse(props);\n    }\n\n    new requiredApp.default({\n      target: root,\n      props: parsedProps\n    });\n  });\n};","position":{"start":{"line":135,"column":1,"offset":3504},"end":{"line":162,"column":4,"offset":4156},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Thats all - diffs of both commits can be found in this ","position":{"start":{"line":163,"column":1,"offset":4157},"end":{"line":163,"column":56,"offset":4212},"indent":[]}},{"type":"link","title":null,"url":"https://gist.github.com/dkuku/cf644f87e984d28f359886da5df307b3","children":[{"type":"text","value":"gist","position":{"start":{"line":163,"column":57,"offset":4213},"end":{"line":163,"column":61,"offset":4217},"indent":[]}}],"position":{"start":{"line":163,"column":56,"offset":4212},"end":{"line":163,"column":126,"offset":4282},"indent":[]}}],"position":{"start":{"line":163,"column":1,"offset":4157},"end":{"line":163,"column":126,"offset":4282},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":164,"column":1,"offset":4283}}}}